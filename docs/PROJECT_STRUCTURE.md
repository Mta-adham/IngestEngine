# Project Structure Guide

This document explains the organization of the IngestEngine repository.

## Directory Structure

### `src/` - Core Modules
**Purpose**: Main functionality modules that are imported and used by other scripts.

**Files**:
- `poi_extractor.py` - Extract POIs from OpenStreetMap
- `dataset_joiner.py` - Dataset joining engine with multiple strategies
- `building_opening_date_estimator.py` - Estimate building opening dates
- `poi_data_cleaner.py` - Clean OSM data for world models
- `poi_change_detector.py` - Detect changes in POIs over time
- `poi_date_extractor.py` - Extract POIs as they existed on specific dates
- `joining.py` - Main entry point for dataset joining
- `UkDataCatalog.py` - UK data catalog definitions
- `catalogue.py` - Catalog utilities

**Usage**: Import these modules in your scripts:
```python
from src.poi_extractor import POIExtractor
from src.dataset_joiner import DatasetJoiner
```

### `scripts/` - Standalone Scripts
**Purpose**: Complete scripts that can be run independently.

**Files**:
- `analyze_london_evolution.py` - Analyze POI evolution over time
- `comprehensive_osm_poi_catalog.py` - Generate comprehensive POI catalog
- `filter_pois_with_names.py` - Filter POIs with names
- `poi_history_tracker.py` - Track historical changes
- `spatial_uprn_joiner.py` - Standalone spatial UPRN joining

**Usage**: Run directly:
```bash
python scripts/analyze_london_evolution.py
```

### `examples/` - Example Scripts
**Purpose**: Example code showing how to use the core modules.

**Files**:
- `example_compare_pois.py` - Example of comparing POI snapshots
- `changeset_query_example.py` - Example of querying OSM changesets

**Usage**: Learn from these examples, adapt for your needs.

### `data/` - Data Files
**Purpose**: Organized data storage.

**Subdirectories**:
- `raw/` - Input data files (place your source data here)
- `processed/` - Processed outputs (generated by scripts)
- `exports/` - Final export files

**Note**: Large CSV files are gitignored. Use `.gitkeep` to preserve directory structure.

### `docs/` - Documentation
**Purpose**: Comprehensive documentation.

**Key Documents**:
- `DATASET_JOINING_GUIDE.md` - Complete joining guide
- `BUILDING_OPENING_DATES.md` - Opening date estimation
- `SPATIAL_UPRN_JOINING.md` - Spatial joining guide
- `OSM_HISTORICAL_DATA_GUIDE.md` - Historical data access

### `config/` - Configuration
**Purpose**: Configuration files for analysis frameworks.

**Files**:
- `evolution_framework.json` - Evolution tracking framework
- `historical_analysis_plan.json` - Historical analysis plan

### `tests/` - Tests
**Purpose**: Unit tests and integration tests (future).

## File Naming Conventions

- **Core modules**: `snake_case.py` (e.g., `poi_extractor.py`)
- **Scripts**: `snake_case.py` (e.g., `analyze_london_evolution.py`)
- **Examples**: `example_*.py` or descriptive names
- **Data files**: `descriptive_name.csv` (e.g., `london_pois_cleaned.csv`)

## Import Paths

All scripts should use absolute imports from `src/`:

```python
# Correct
from src.poi_extractor import POIExtractor
from src.dataset_joiner import DatasetJoiner

# Incorrect
from poi_extractor import POIExtractor  # Don't do this
```

## Adding New Files

### Adding a Core Module
1. Place in `src/`
2. Use clear, descriptive name
3. Add to `src/__init__.py` if needed
4. Document in README

### Adding a Script
1. Place in `scripts/`
2. Make it runnable standalone
3. Add usage comments at top
4. Update README if it's a main feature

### Adding an Example
1. Place in `examples/`
2. Keep it simple and clear
3. Add comments explaining usage
4. Reference in relevant docs

## Data Organization

### Raw Data (`data/raw/`)
- Place input files here
- Don't commit large files
- Use descriptive names
- Document data sources

### Processed Data (`data/processed/`)
- Generated by scripts
- Gitignored by default
- Keep organized by type
- Use consistent naming

### Exports (`data/exports/`)
- Final output files
- Ready for sharing/analysis
- Document format and structure

## Best Practices

1. **Keep core modules focused**: Each module should do one thing well
2. **Scripts should be standalone**: Include all necessary imports
3. **Document your code**: Add docstrings and comments
4. **Follow naming conventions**: Use snake_case for files
5. **Organize data properly**: Use appropriate subdirectories
6. **Update documentation**: Keep README and docs current

## Maintenance

- **Regular cleanup**: Remove unused files
- **Update structure**: Keep this document current
- **Review imports**: Ensure all imports work
- **Test structure**: Verify scripts can find modules

